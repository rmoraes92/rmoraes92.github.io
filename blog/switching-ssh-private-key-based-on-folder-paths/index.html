<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/bootstrap.rtl.min.css" rel="stylesheet">
    <style>
        pre {
            padding: 16px;
        }
    </style>
    <title>9th Inning Thoughts - </title>
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col-12">
                <h1 class="title text-center">
                    <a href="/">9th Inning Thoughts</a>
                    <br>
                    <small class="text-body-secondary">When the bases are full a single bunt will suffice</small>
                </h1>
                <hr>
                <ul class="nav justify-content-center">
                    <li class="nav-item">
                        <a class="nav-link" href="http://rmoraes92.github.io/blog/">
                            Blog
                        </a>
                    </li>
                    <li class="nav-item">
                        <a target="_blank" class="nav-link" aria-current="page" href="https://www.linkedin.com/in/ramonmoraes8080/">
                            About
                        </a>
                    </li>
                    <li class="nav-item">
                        <a target="_blank" class="nav-link" href="https://github.com/rmoraes92">
                            GitHub
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <br>
        
<div class="row">
    <div class="col-12 text-center">
        <h1 class="title">
            Switching SSH Private Key based on Folder Paths
        </h1>
        <small class="text-body-secondary">
            <em>2026-02-08T00:00:00-03:00</em>
        </small>
    </div>
</div>
<br>
<br>
<h2 id="intro">Intro</h2>
<p>Anyone working on multiple repositories from
multiple clients developer will adopt the pattern
of using a single Private Key shared between
project to facilitate the workflow.</p>
<p>The problem with that approach is: Once your
private key gets leaked every single repository
you had associed with is now compromised.</p>
<p>To avoid that I prefer to use different keys
to different groups of repositories.</p>
<h2 id="the-first-step">The First Step</h2>
<p>The easiest way to start working with multiple
keys is make use of <code>.ssh/config</code> file.</p>
<p>This file let us create a set of
configurations based on domain used by git.</p>
<p>Let's assume you have two repos:</p>
<ul>
<li>
<p><code>git@github.com:acmegroup/repo-1.git</code></p>
<ul>
<li>project which belongs to ACME Company</li>
</ul>
</li>
<li>
<p><code>git@github.com:johndoe/repo-2.git</code>:</p>
<ul>
<li>personal project</li>
</ul>
</li>
</ul>
<p>To avoid any chances of editing the wrong "repo-X"
We will organize them in sub-folders:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>/home/johndoe
</span><span>    ├── Projects
</span><span>    │   ├── acme
</span><span>    │   └── personal
</span></code></pre>
<p>and here's our <code>.ssh/</code> folder:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>/home/johndoe/.ssh
</span><span>  id_ed25519
</span><span>  id_ed25519.pub
</span><span>  id_ed25519_acme
</span><span>  id_ed25519_acme.pub
</span></code></pre>
<p>Where <code>id_ed25519</code> is our Secret Key for personal
projects.</p>
<p>Now we will clone our private repo on the
<strong>personal</strong> folder:</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#96b5b4;">cd </span><span style="color:#bf616a;">~</span><span>/Projects/personal
</span><span style="color:#bf616a;">git</span><span> clone git@github.com:johndoe/repo-2.git
</span></code></pre>
<p>That will work just fine, resulting in:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>/home/johndoe
</span><span>    ├── Projects
</span><span>    │   ├── acme
</span><span>    │   └── personal
</span><span>    │       └── repo-2
</span></code></pre>
<p>but if you try the same for the <strong>repo-1</strong> it will
not work.</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#96b5b4;">cd </span><span style="color:#bf616a;">~</span><span>/Projects/acme;
</span><span style="color:#bf616a;">git</span><span> clone git@github.com:acmegroup/repo-1.git
</span></code></pre>
<p>It will fail because <code>git</code> will try to use the
same key for the personal repos.</p>
<p>We can represent the <code>git clone</code> as:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>FROM git@github.com CLONE acmegroup/repo-1 WITH ~/.ssh/id_ed25519
</span></code></pre>
<blockquote>
<p>So how can we tell <code>git</code> (<code>ssh</code>) to use a different key?</p>
</blockquote>
<p>We edit the <code>.ssh/config</code> file and tell <code>ssh</code> to
use a certain key when trying to reach certain
host domain:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span># ~/.ssh/config
</span><span>Host github.com
</span><span>    IdentityFile ~/.ssh/id_ed25519_acme
</span></code></pre>
<p>then we re-execute:</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#96b5b4;">cd </span><span style="color:#bf616a;">~</span><span>/Projects/acme;
</span><span style="color:#bf616a;">git</span><span> clone git@github.com:acmegroup/repo-1.git
</span></code></pre>
<p>resulting in:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>/home/johndoe
</span><span>    ├── Projects
</span><span>    │   ├── acme
</span><span>    │       └── repo-1
</span><span>    │   └── personal
</span><span>    │       └── repo-2
</span></code></pre>
<p>All done! Right? Not quite, but we are halfway
there.</p>
<p>Even though our previous <code>git clone</code> for ACME's
repo-1 will worked now any other operations
(push, fetch, etc) for our personal's repo-2 will
fail.</p>
<blockquote>
<p>How do we fix the personal repository operation?</p>
</blockquote>
<p>Simple. Instead of using <code>github.com</code> we will use
a custom (alias) domain when cloning our
non-personal repositories. For example:
We will use <code>github_acme.com</code> (alias) domain when
cloning our ACME's repo-1.</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#96b5b4;">cd </span><span style="color:#bf616a;">~</span><span>/Projects/acme;
</span><span style="color:#bf616a;">git</span><span> clone git@github_acme.com:acmegroup/repo-1.git
</span></code></pre>
<p>Of course the new (alias) domain does not exist
in the real WWW and cloning will fail. That is
because we need one last step: Update the <code>.ssh/config</code>
file to handle the "alias" domain.</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>Host github_acme.com
</span><span>	IdentityFile ~/.ssh/id_ed25519_acme
</span><span>	HostName github.com
</span></code></pre>
<p>This will tell <code>ssh</code> to <strong>do</strong> two things
<strong>before</strong> when we try to clone from the custom
<code>github_acme.com</code>:</p>
<ul>
<li>
<p>replace the original domain <code>github_acme.com</code>
with <code>github.com</code></p>
</li>
<li>
<p>use the <code>/home/johndoe/.ssh/id_ed25519_acme</code> as
the private key for the request.</p>
</li>
</ul>
<p>We can represent that as something like:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>IF host == github_acme.com THEN
</span><span>    FROM git@github.com CLONE &lt;some-repo&gt; WITH ~/.ssh/id_ed25519_acme
</span><span>ELSE
</span><span>    FROM git@github.com CLONE &lt;some-repo&gt; WITH ~/.ssh/id_ed25519
</span><span>END
</span></code></pre>
<p>At this point you're all set to start working
with even more Secrets Keys per repository.</p>
<p>As long as you <strong>remember</strong> to <strong>always</strong> adjust
your git repo's domain to match the configuration
from <code>.ssh/config</code></p>
<h2 id="over-engineering-to-reduce-cognitive-load">Over-engineering to reduce cognitive load</h2>
<p>At some point the <strong>motions</strong> required to adjust
your git repo's domain will get old. Believe me.</p>
<p>The endgame here is to:</p>
<ul>
<li>
<p>keep <code>ssh</code> being able to select the correct
secret key</p>
</li>
<li>
<p>stop having to rewrite our git domain</p>
</li>
</ul>
<p>To do so we will create a <code>.gitconfig_acme</code> to
change the git domain (<code>github.com</code>) to the
"alias" domain we use on <code>.ssh/config</code>: <code>github_acme.com</code></p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span># ~/.gitconfig_acme
</span><span>[url &quot;git@github_acme.com&quot;]
</span><span>  insteadOf = git@github.com
</span></code></pre>
<p>And we want to do that <strong>only</strong> for git operations
from our <code>~/Projects/acme</code> folder. That is
achieved by editting the <code>~/.gitconfig</code> (no suffix)</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span># ~/.gitconfig
</span><span>[includeIf &quot;gitdir:~/Projects/acme/&quot;]
</span><span>    path = .gitconfig_acme
</span></code></pre>
<p>So now everytime we do:</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#96b5b4;">cd </span><span style="color:#bf616a;">~</span><span>/Projects/acme;
</span><span style="color:#bf616a;">git</span><span> clone git@github.com:acmegroup/repo-1.git
</span></code></pre>
<p>The following logic will be executed:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>GIT {
</span><span>  IF current_path == ~/Projects/acme THEN
</span><span>    host = github_acme.com
</span><span>  END
</span><span>}
</span><span>
</span><span>SSH {
</span><span>  IF host == github_acme.com THEN
</span><span>    FROM git@github.com CLONE &lt;some-repo&gt; WITH ~/.ssh/id_ed25519_acme
</span><span>  ELSE
</span><span>    FROM git@github.com CLONE &lt;some-repo&gt; WITH ~/.ssh/id_ed25519
</span><span>  END
</span><span>}
</span></code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>We added two extra steps of rewriting our initial
request but in exchange we finally achieve and
smooth git workflow working with multiple secret
keys.</p>



    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    
        <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-M4Z52FB0PK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-M4Z52FB0PK');
</script>

    
</body>
</html>
